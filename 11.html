<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>INGRES AI ChatBOT</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Fonts: Inter -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        /* Custom styles for the app */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f8fafc; /* bg-slate-50 */
        }
        /* Custom scrollbar for better aesthetics in a light theme */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #e2e8f0;
        }
        ::-webkit-scrollbar-thumb {
            background: #94a3b8;
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #64748b;
        }
        .text-gradient {
            background: linear-gradient(90deg, #2563eb, #0891b2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        /* For language drawer animation */
        #language-chevron {
            transition: transform 0.3s ease-in-out;
        }
        
        /* Style for Mic Button when listening */
        #mic-btn.listening svg {
            color: #ef4444; /* text-red-500 */
        }

    </style>
</head>
<body class="bg-slate-50 text-slate-800 flex antialiased">

    <!-- Left Sidebar -->
    <aside class="w-80 h-screen bg-white p-5 flex flex-col shrink-0 border-r border-slate-200 shadow-sm">
        <!-- Header Section -->
        <div class="flex items-center justify-between mb-8">
            <div class="flex items-center gap-3">
                <!-- CGWB Logo -->
                <img src="https://cgwb.gov.in/sites/default/files/inline-files/logo_1.jpg" alt="CGWB Logo" class="h-9 w-10 object-contain">
                <div>
                    <span class="font-bold text-xl text-slate-900">INGRES</span>
                    <p class="text-xs text-slate-500 -mt-1">by Ministry of Jal Shakti</p>
                </div>
            </div>
            <div class="flex items-center gap-2 text-slate-500">
                <!-- Chevron down icon -->
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m6 9 6 6 6-6"/></svg>
            </div>
        </div>

        <!-- Navigation Links -->
        <nav class="flex-grow space-y-2">
            <a href="#" class="flex items-start gap-3 p-3 rounded-lg bg-gradient-to-r from-blue-600 to-cyan-500 text-white shadow-lg shadow-blue-500/30 transition-colors">
                <!-- Dashboard Icon -->
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="mt-0.5 shrink-0"><rect x="3" y="3" width="7" height="9"></rect><rect x="14" y="3" width="7" height="5"></rect><rect x="14" y="12" width="7" height="9"></rect><rect x="3" y="16" width="7" height="5"></rect></svg>
                <div>
                    <p class="font-semibold">Dashboard</p>
                    <p class="text-sm text-blue-100">Real-time data & overview</p>
                </div>
            </a>
            <button id="visualization-btn" class="w-full flex items-start gap-3 p-3 rounded-lg hover:bg-slate-100 transition-colors group text-left">
                <!-- Visualizations Icon -->
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="mt-0.5 shrink-0 text-slate-500 group-hover:text-blue-600"><path d="M21.21 15.89A10 10 0 1 1 8 2.83"/><path d="M22 12A10 10 0 0 0 12 2v10z"/></svg>
                <div>
                    <p class="font-medium text-slate-700 group-hover:text-slate-800">Visualizations</p>
                    <p class="text-sm text-slate-500">Saved charts, maps & timelines</p>
                </div>
            </button>
            <button id="rainfall-btn" class="w-full flex items-start gap-3 p-3 rounded-lg hover:bg-slate-100 transition-colors group text-left">
                <!-- Live Rainfall Icon -->
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="mt-0.5 shrink-0 text-slate-500 group-hover:text-blue-600"><path d="M22 12a10.06 10.06 0 0 0-2-6.23"/><path d="M2 12a10.06 10.06 0 0 0 2 6.23"/><path d="M12 22a10.06 10.06 0 0 0 6.23-2"/><path d="M12 2a10.06 10.06 0 0 0-6.23 2"/><path d="M12 18a6 6 0 1 0 0-12 6 6 0 0 0 0 12Z"/><path d="M12 15a3 3 0 1 0 0-6 3 3 0 0 0 0 6Z"/></svg>
                <div>
                    <p class="font-medium text-slate-700 group-hover:text-slate-800">Live Rainfall Data</p>
                    <p class="text-sm text-slate-500">View real-time rainfall</p>
                </div>
            </button>
            <div>
                <button id="language-btn" class="w-full flex items-start gap-3 p-3 rounded-lg hover:bg-slate-100 transition-colors group text-left">
                     <!-- Language Icon -->
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="mt-0.5 shrink-0 text-slate-500 group-hover:text-blue-600"><path d="m5 8 6 6"/><path d="m4 14 6-6 2-3"/><path d="M2 5h12"/><path d="M7 2h1"/><path d="m22 22-5-10-5 10"/><path d="M14 18h6"/></svg>
                    <div class="flex-grow">
                        <p class="font-medium text-slate-700 group-hover:text-slate-800">Language</p>
                        <p class="text-sm text-slate-500">Switch to a regional language</p>
                    </div>
                    <svg id="language-chevron" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="mt-1 shrink-0 text-slate-500"><path d="m6 9 6 6 6-6"/></svg>
                </button>
                <div id="language-list" class="hidden mt-2 ml-6 pl-5 border-l-2 border-slate-200">
                    <ul class="space-y-1 text-sm text-slate-600">
                        <li><a href="#" class="block p-2 rounded-md hover:bg-slate-100 hover:text-blue-600">Hindi (हिन्दी)</a></li>
                        <li><a href="#" class="block p-2 rounded-md hover:bg-slate-100 hover:text-blue-600">Bengali (বাংলা)</a></li>
                        <li><a href="#" class="block p-2 rounded-md hover:bg-slate-100 hover:text-blue-600">Telugu (తెలుగు)</a></li>
                        <li><a href="#" class="block p-2 rounded-md hover:bg-slate-100 hover:text-blue-600">Marathi (मराठी)</a></li>
                        <li><a href="#" class="block p-2 rounded-md hover:bg-slate-100 hover:text-blue-600">Tamil (தமிழ்)</a></li>
                        <li><a href="#" class="block p-2 rounded-md hover:bg-slate-100 hover:text-blue-600">Urdu (اردو)</a></li>
                        <li><a href="#" class="block p-2 rounded-md hover:bg-slate-100 hover:text-blue-600">Gujarati (ગુજરાતી)</a></li>
                        <li><a href="#" class="block p-2 rounded-md hover:bg-slate-100 hover:text-blue-600">Kannada (ಕನ್ನಡ)</a></li>
                        <li><a href="#" class="block p-2 rounded-md hover:bg-slate-100 hover:text-blue-600">Odia (ଓଡ଼ିଆ)</a></li>
                        <li><a href="#" class="block p-2 rounded-md hover:bg-slate-100 hover:text-blue-600">Malayalam (മലയാളം)</a></li>
                    </ul>
                </div>
            </div>
        </nav>

        <!-- Bottom Section -->
        <div class="space-y-4 pt-6 border-t border-slate-200">
             <!-- Conversations Section -->
            <div>
                <h3 class="px-2 font-semibold text-slate-800 mb-2">Chat History</h3>
                <div class="space-y-1">
                    <a href="#" class="block text-sm text-slate-600 hover:text-blue-600 p-2 rounded-md hover:bg-slate-100 truncate">Over-exploited blocks in Punjab</a>
                    <a href="#" class="block text-sm text-slate-600 hover:text-blue-600 p-2 rounded-md hover:bg-slate-100 truncate">Rainfall comparison 2023 vs 2024</a>
                    <a href="#" class="block text-sm text-slate-600 hover:text-blue-600 p-2 rounded-md hover:bg-slate-100 truncate">Groundwater levels in Maharashtra</a>
                </div>
            </div>
        </div>
    </aside>

    <!-- Main Content -->
    <main class="flex-1 flex flex-col p-6 h-screen">
        <!-- Main Header -->
        <header class="w-full flex justify-end">
            <button class="flex items-center gap-2 bg-gradient-to-r from-blue-600 to-cyan-500 hover:from-blue-700 hover:to-cyan-600 text-white font-medium py-2 px-4 rounded-full transition-all duration-300 shadow-lg shadow-blue-500/20 hover:shadow-xl hover:shadow-blue-500/40 transform hover:-translate-y-px">
                <span>Sign in</span>
                 <!-- User Icon -->
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>
            </button>
        </header>

        <!-- Chat Interface -->
        <div class="flex-grow flex items-center justify-center">
            <div class="w-full max-w-3xl mx-auto flex flex-col items-center">
                
                <div id="chat-container" class="w-full mb-4 h-96 overflow-y-auto p-4 flex flex-col justify-center">
                     <h1 class="text-4xl md:text-5xl font-bold text-slate-700 text-center mb-10"><span class="text-gradient">Welcome to the INGRES AI</span></h1>
                </div>

                <!-- Input Box -->
                <div class="w-full bg-white border border-slate-200 rounded-2xl p-2 relative shadow-xl shadow-slate-200/80 transition-all duration-300 focus-within:ring-4 focus-within:ring-blue-300/50 focus-within:border-blue-400">
                    <textarea id="chat-input" class="w-full bg-transparent text-slate-800 placeholder-slate-400 text-lg resize-none focus:outline-none p-3 pr-32" rows="1" placeholder="Ask about India's groundwater resources..."></textarea>
                    
                    <div class="absolute top-1/2 -translate-y-1/2 right-3 flex items-center gap-1">
                        <button id="send-btn" class="bg-gradient-to-r from-blue-600 to-cyan-500 hover:from-blue-700 hover:to-cyan-600 rounded-full p-2.5 transition-all duration-300 shadow-md hover:shadow-lg transform hover:scale-105">
                             <!-- Send Icon -->
                            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="#fff" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 14 21 3"/><path d="M21 3l-6.5 18a.55.55 0 0 1-1 0L10 14l-7-3.5a.55.55 0 0 1 0-1L21 3z"/></svg>
                        </button>
                        <button class="text-slate-500 hover:text-blue-600 p-2.5 rounded-full hover:bg-slate-100 transition-colors">
                             <!-- Plus Icon -->
                            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M5 12h14"/><path d="M12 5v14"/></svg>
                        </button>
                        <button id="mic-btn" class="text-slate-500 hover:text-blue-600 p-2.5 rounded-full hover:bg-slate-100 transition-colors">
                            <!-- Mic Icon -->
                             <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 1a3 3 0 0 0-3 3v8a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3z"/><path d="M19 10v2a7 7 0 0 1-14 0v-2"/><line x1="12" x2="12" y1="19" y2="22"/></svg>
                        </button>
                    </div>
                </div>

                <!-- Suggestion Buttons -->
                <div id="suggestion-buttons" class="grid grid-cols-2 md:grid-cols-4 gap-3 mt-8 w-full">
                    <button class="bg-white/60 hover:bg-white text-slate-700 font-medium py-2.5 px-4 rounded-lg transition-all duration-200 text-left text-sm border border-slate-200 shadow-sm hover:shadow-lg hover:border-blue-300 transform hover:-translate-y-0.5">Groundwater level in my state?</button>
                    <button class="bg-white/60 hover:bg-white text-slate-700 font-medium py-2.5 px-4 rounded-lg transition-all duration-200 text-left text-sm border border-slate-200 shadow-sm hover:shadow-lg hover:border-blue-300 transform hover:-translate-y-0.5">Show over-exploited blocks</button>
                    <button class="bg-white/60 hover:bg-white text-slate-700 font-medium py-2.5 px-4 rounded-lg transition-all duration-200 text-left text-sm border border-slate-200 shadow-sm hover:shadow-lg hover:border-blue-300 transform hover:-translate-y-0.5">Compare rainfall data</button>
                    <button class="bg-white/60 hover:bg-white text-slate-700 font-medium py-2.5 px-4 rounded-lg transition-all duration-200 text-left text-sm border border-slate-200 shadow-sm hover:shadow-lg hover:border-blue-300 transform hover:-translate-y-0.5">Explain 'Safe' category</button>
                    <button class="bg-white/60 hover:bg-white text-slate-700 font-medium py-2.5 px-4 rounded-lg transition-all duration-200 text-left text-sm border border-slate-200 shadow-sm hover:shadow-lg hover:border-blue-300 transform hover:-translate-y-0.5">Generate a report for a region</button>
                    <button class="bg-white/60 hover:bg-white text-slate-700 font-medium py-2.5 px-4 rounded-lg transition-all duration-200 text-left text-sm border border-slate-200 shadow-sm hover:shadow-lg hover:border-blue-300 transform hover:-translate-y-0.5">Find historical data</button>
                    <button class="bg-white/60 hover:bg-white text-slate-700 font-medium py-2.5 px-4 rounded-lg transition-all duration-200 text-left text-sm border border-slate-200 shadow-sm hover:shadow-lg hover:border-blue-300 transform hover:-translate-y-0.5">Stage of extraction in my block?</button>
                    <button class="bg-white/60 hover:bg-white text-slate-700 font-medium py-2.5 px-4 rounded-lg transition-all duration-200 text-left text-sm border border-slate-200 shadow-sm hover:shadow-lg hover:border-blue-300 transform hover:-translate-y-0.5">Show a map of critical zones</button>
                </div>
            </div>
        </div>
    </main>
    
    <!-- Visualization Modal -->
    <div id="visualization-modal" class="hidden fixed inset-0 bg-slate-900/50 z-50 flex items-center justify-center p-4">
        <div class="bg-white w-full max-w-2xl rounded-2xl shadow-2xl p-8 transform transition-all scale-95 opacity-0" id="modal-panel">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-2xl font-bold text-slate-800">Create Visualization</h2>
                <button id="modal-close-btn" class="p-2 rounded-full hover:bg-slate-100">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-slate-600"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>
                </button>
            </div>
            
            <!-- Filters -->
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                <div>
                    <label for="assessment-year" class="block text-sm font-medium text-slate-700 mb-1">Assessment Year</label>
                    <select id="assessment-year" class="w-full p-2 border border-slate-300 rounded-md focus:ring-blue-500 focus:border-blue-500">
                        <option>2024</option>
                        <option>2023</option>
                        <option>2022</option>
                        <option>2021</option>
                    </select>
                </div>
                 <div>
                    <label for="state" class="block text-sm font-medium text-slate-700 mb-1">State</label>
                    <select id="state" class="w-full p-2 border border-slate-300 rounded-md focus:ring-blue-500 focus:border-blue-500">
                        <option>Select State</option>
                        <option>Andhra Pradesh</option>
                        <option>Maharashtra</option>
                        <option>Punjab</option>
                    </select>
                </div>
                <div>
                    <label for="district" class="block text-sm font-medium text-slate-700 mb-1">District</label>
                    <select id="district" class="w-full p-2 border border-slate-300 rounded-md focus:ring-blue-500 focus:border-blue-500">
                        <option>Select District</option>
                    </select>
                </div>
                 <div>
                    <label for="block" class="block text-sm font-medium text-slate-700 mb-1">Block</label>
                    <select id="block" class="w-full p-2 border border-slate-300 rounded-md focus:ring-blue-500 focus:border-blue-500">
                        <option>Select Block</option>
                    </select>
                </div>
            </div>

            <!-- Visualization Type -->
            <div class="border-t border-slate-200 pt-6">
                <h3 class="text-lg font-semibold text-slate-700 mb-4">Visualization Type</h3>
                <div class="flex items-center gap-4">
                     <button class="flex-1 flex flex-col items-center justify-center gap-2 p-4 border-2 border-blue-500 bg-blue-50 rounded-lg text-blue-700 font-semibold">
                         <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21.21 15.89A10 10 0 1 1 8 2.83"/><path d="M22 12A10 10 0 0 0 12 2v10z"/></svg>
                         Chart
                     </button>
                     <button class="flex-1 flex flex-col items-center justify-center gap-2 p-4 border border-slate-300 rounded-lg text-slate-600 hover:border-slate-400 hover:bg-slate-50">
                          <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 3v18h18"/><path d="m19 9-5 5-4-4-3 3"/></svg>
                         Graph
                     </button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Live Rainfall Modal -->
    <div id="rainfall-modal" class="hidden fixed inset-0 bg-slate-900/50 z-50 flex items-center justify-center p-4">
        <div class="bg-white w-full max-w-4xl h-[90vh] rounded-2xl shadow-2xl p-8 transform transition-all scale-95 opacity-0 flex flex-col" id="rainfall-panel">
            <div class="flex justify-between items-center mb-6 shrink-0">
                <h2 class="text-2xl font-bold text-slate-800">Live Rainfall Data</h2>
                <button id="rainfall-close-btn" class="p-2 rounded-full hover:bg-slate-100">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-slate-600"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>
                </button>
            </div>
            
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 flex-grow min-h-0">
                <!-- Left panel with filters and list -->
                <div class="md:col-span-1 flex flex-col min-h-0">
                    <div class="space-y-4 mb-4">
                        <div>
                            <label for="rainfall-state" class="block text-sm font-medium text-slate-700 mb-1">State</label>
                            <select id="rainfall-state" class="w-full p-2 border border-slate-300 rounded-md focus:ring-blue-500 focus:border-blue-500">
                                <option value="All India">All India</option>
                                <option value="Andaman and Nicobar Islands">Andaman and Nicobar Islands</option>
                                <option value="Andhra Pradesh">Andhra Pradesh</option>
                                <option value="Arunachal Pradesh">Arunachal Pradesh</option>
                                <option value="Assam">Assam</option>
                                <option value="Bihar">Bihar</option>
                                <option value="Chandigarh">Chandigarh</option>
                                <option value="Chhattisgarh">Chhattisgarh</option>
                                <option value="Dadra and Nagar Haveli and Daman and Diu">Dadra and Nagar Haveli and Daman and Diu</option>
                                <option value="Delhi">Delhi</option>
                                <option value="Goa">Goa</option>
                                <option value="Gujarat">Gujarat</option>
                                <option value="Haryana">Haryana</option>
                                <option value="Himachal Pradesh">Himachal Pradesh</option>
                                <option value="Jammu and Kashmir">Jammu and Kashmir</option>
                                <option value="Jharkhand">Jharkhand</option>
                                <option value="Karnataka">Karnataka</option>
                                <option value="Kerala">Kerala</option>
                                <option value="Ladakh">Ladakh</option>
                                <option value="Lakshadweep">Lakshadweep</option>
                                <option value="Madhya Pradesh">Madhya Pradesh</option>
                                <option value="Maharashtra">Maharashtra</option>
                                <option value="Manipur">Manipur</option>
                                <option value="Meghalaya">Meghalaya</option>
                                <option value="Mizoram">Mizoram</option>
                                <option value="Nagaland">Nagaland</option>
                                <option value="Odisha">Odisha</option>
                                <option value="Puducherry">Puducherry</option>
                                <option value="Punjab">Punjab</option>
                                <option value="Rajasthan">Rajasthan</option>
                                <option value="Sikkim">Sikkim</option>
                                <option value="Tamil Nadu">Tamil Nadu</option>
                                <option value="Telangana">Telangana</option>
                                <option value="Tripura">Tripura</option>
                                <option value="Uttar Pradesh">Uttar Pradesh</option>
                                <option value="Uttarakhand">Uttarakhand</option>
                                <option value="West Bengal">West Bengal</option>
                            </select>
                        </div>
                    </div>
                    <h3 class="font-semibold text-slate-700 mb-2">Stations</h3>
                    
                    <div class="flex-grow overflow-y-auto pr-2" id="station-list-container">
                        <ul class="space-y-2" id="station-list">
                            <!-- Station data will be dynamically injected here by JavaScript -->
                             <li class="p-3 text-slate-500">Please select a state to see stations.</li>
                        </ul>
                    </div>
                </div>
                <!-- Right panel with map -->
                <div class="md:col-span-2 bg-slate-100 rounded-lg flex items-center justify-center">
                     <div class="text-center text-slate-500">
                         <svg xmlns="http://www.w3.org/2000/svg" width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="mx-auto mb-2 text-slate-400"><path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"></path><circle cx="12" cy="10" r="3"></circle></svg>
                        <p>Live Map Visualization Area</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // --- Visualization Modal ---
        const visualizationBtn = document.getElementById('visualization-btn');
        const visualizationModal = document.getElementById('visualization-modal');
        const modalPanel = document.getElementById('modal-panel');
        const modalCloseBtn = document.getElementById('modal-close-btn');

        const openModal = () => {
            visualizationModal.classList.remove('hidden');
            setTimeout(() => {
                modalPanel.classList.remove('scale-95', 'opacity-0');
            }, 50);
        };

        const closeModal = () => {
             modalPanel.classList.add('scale-95', 'opacity-0');
             setTimeout(() => {
                 visualizationModal.classList.add('hidden');
            }, 200);
        };
        
        visualizationBtn.addEventListener('click', openModal);
        modalCloseBtn.addEventListener('click', closeModal);
        visualizationModal.addEventListener('click', (e) => {
            if (e.target === visualizationModal) closeModal();
        });


        // --- Live Rainfall Modal ---
        const rainfallBtn = document.getElementById('rainfall-btn');
        const rainfallModal = document.getElementById('rainfall-modal');
        const rainfallPanel = document.getElementById('rainfall-panel');
        const rainfallCloseBtn = document.getElementById('rainfall-close-btn');

        // --- NEW: Elements for FIX 3 (Weather API) ---
        const rainfallStateSelect = document.getElementById('rainfall-state');
        const stationList = document.getElementById('station-list');
        const stationListContainer = document.getElementById('station-list-container');
        
        // --- API KEY INTEGRATED ---
        const OPENWEATHER_API_KEY = 'fa13fca6c1ae302cc5413b49c57c5663'; 

        // Data for which cities to show per state
        const stateCities = {
            'Maharashtra': ['Mumbai', 'Pune', 'Nagpur', 'Nashik'],
            'Punjab': ['Ludhiana', 'Amritsar', 'Jalandhar'],
            'Andhra Pradesh': ['Vijayawada', 'Visakhapatnam', 'Guntur'],
            'Delhi': ['New Delhi'],
            'Tamil Nadu': ['Chennai', 'Coimbatore', 'Madurai'],
            'Karnataka': ['Bengaluru', 'Mysuru', 'Hubballi'],
            'Uttar Pradesh': ['Lucknow', 'Kanpur', 'Agra', 'Varanasi'],
            'West Bengal': ['Kolkata', 'Howrah', 'Durgapur'],
            'Rajasthan': ['Jaipur', 'Jodhpur', 'Udaipur'],
            'Gujarat': ['Ahmedabad', 'Surat', 'Vadodara'],
            // Add more states and cities as needed
        };

        // --- NEW: Function for FIX 3 (Fetch Weather Data) ---
        async function fetchRainfallData(state) {
            if (!OPENWEATHER_API_KEY || OPENWEATHER_API_KEY === 'c0b80c9dd465621f1dcc97c46889c6f6') {
                stationList.innerHTML = `<li class="p-3 text-red-600 font-medium">API key is missing or invalid. Please check the &lt;script&gt; tag.</li>`;
                return;
            }

            if (!state || state === 'All India') {
                stationList.innerHTML = '<li class="p-3 text-slate-500">Please select a state to see stations.</li>';
                return;
            }

            const cities = stateCities[state];
            if (!cities) {
                stationList.innerHTML = `<li class="p-3 text-slate-500">No station data available for ${state}.</li>`;
                return;
            }

            // Show loading spinner
            stationList.innerHTML = `
                <li class="p-3 flex items-center justify-center text-slate-500">
                    <svg class="animate-spin -ml-1 mr-3 h-5 w-5 text-blue-600" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                        <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                        <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                    </svg>
                    Loading stations for ${state}...
                </li>`;

            // Use Promise.all to fetch all cities in parallel
            const weatherPromises = cities.map(async (city) => {
                try {
                    const response = await fetch(`https://api.openweathermap.org/data/2.5/weather?q=${city}&appid=${OPENWEATHER_API_KEY}&units=metric`);
                    if (!response.ok) {
                        throw new Error(`Could not fetch data for ${city}`);
                    }
                    const data = await response.json();
                    
                    // OpenWeatherMap rainfall is in 'rain.1h'
                    const rainfall = data.rain ? (data.rain['1h'] || 0) : 0;
                    const temp = data.main.temp;
                    const description = data.weather[0].description;
                    
                    return { city, rainfall, temp, description, success: true };
                } catch (error) {
                    console.error(error);
                    return { city, success: false };
                }
            });

            const results = await Promise.all(weatherPromises);
            
            // Clear loading spinner
            stationList.innerHTML = '';
            
            if (results.length === 0) {
                 stationList.innerHTML = `<li class="p-3 text-slate-500">No stations found for ${state}.</li>`;
                 return;
            }

            results.forEach(res => {
                const li = document.createElement('li');
                li.className = 'p-3 rounded-lg border border-slate-200 hover:bg-slate-50 transition-colors';
                
                if (res.success) {
                    let rainfallColor = 'text-slate-600';
                    if (res.rainfall > 10) rainfallColor = 'text-blue-600'; // Heavy rain
                    else if (res.rainfall > 0) rainfallColor = 'text-green-600'; // Light rain

                    li.innerHTML = `
                        <div class="flex justify-between items-center">
                            <p class="font-semibold text-slate-800">${res.city}</p>
                            <span class="font-bold ${rainfallColor}">${res.rainfall} mm</span>
                        </div>
                        <p class="text-sm text-slate-500 capitalize">Current: ${res.temp.toFixed(1)}°C, ${res.description}</p>
                    `;
                } else {
                    li.innerHTML = `
                        <div class="flex justify-between items-center">
                            <p class="font-semibold text-red-600">${res.city}</p>
                            <span class="text-sm text-red-500">Failed to load</span>
                        </div>
                    `;
                }
                stationList.appendChild(li);
            });
        }

        // --- MODIFIED: openRainfallModal ---
        const openRainfallModal = () => {
            rainfallModal.classList.remove('hidden');
            setTimeout(() => {
                rainfallPanel.classList.remove('scale-95', 'opacity-0');
            }, 50);
            // Trigger initial render based on the currently selected state
            fetchRainfallData(rainfallStateSelect.value);
        };

        const closeRainfallModal = () => {
             rainfallPanel.classList.add('scale-95', 'opacity-0');
             setTimeout(() => {
                 rainfallModal.classList.add('hidden');
            }, 200);
        };
        
        rainfallBtn.addEventListener('click', openRainfallModal);
        rainfallCloseBtn.addEventListener('click', closeRainfallModal);
        rainfallModal.addEventListener('click', (e) => {
            if (e.target === rainfallModal) closeRainfallModal();
        });

        // --- NEW: Event listener for FIX 3 ---
        rainfallStateSelect.addEventListener('change', (e) => {
            fetchRainfallData(e.target.value);
        });


        // --- Language Drawer ---
        const languageBtn = document.getElementById('language-btn');
        const languageList = document.getElementById('language-list');
        const languageChevron = document.getElementById('language-chevron');

        languageBtn.addEventListener('click', () => {
            const isHidden = languageList.classList.contains('hidden');
            if (isHidden) {
                languageList.classList.remove('hidden');
                languageChevron.style.transform = 'rotate(180deg)';
            } else {
                languageList.classList.add('hidden');
                languageChevron.style.transform = 'rotate(0deg)';
            }
        });
        
        // --- Textarea auto-resize ---
        const mainTextarea = document.getElementById('chat-input');
        mainTextarea.addEventListener('input', () => {
            mainTextarea.style.height = 'auto';
            if (mainTextarea.scrollHeight > 240) {
                 mainTextarea.style.height = '240px';
                 mainTextarea.style.overflowY = 'auto';
            } else {
                 mainTextarea.style.height = (mainTextarea.scrollHeight) + 'px';
                 mainTextarea.style.overflowY = 'hidden';
            }
        });


        // --- Chatbot Connection Logic ---
        const sendBtn = document.getElementById('send-btn');
        const chatInput = document.getElementById('chat-input');
        const chatContainer = document.getElementById('chat-container');
        const suggestionButtonsContainer = document.getElementById('suggestion-buttons');
        
        // --- NEW: Element for FIX 2 (Voice Input) ---
        const micBtn = document.getElementById('mic-btn');


        // IMPORTANT: The ngrok URL has been updated with the one you provided.
        const BOT_API_URL = "https://dnaitik-ingres-chatbot.hf.space/chat";

        async function sendMessageToBot(messageText) {
            // Use messageText if provided (from voice or suggestion), otherwise get from input
            const message = messageText || chatInput.value.trim();
            if (!message) return;

            // Clear the welcome message on first interaction
            const welcomeMessage = chatContainer.querySelector('h1');
            if (welcomeMessage) {
                welcomeMessage.remove();
                // --- MODIFIED: FIX 1 ---
                // Remove the centering class so messages align to top
                chatContainer.classList.remove('justify-center');
            }

            // Display user message
            const userMessageElem = document.createElement('div');
            userMessageElem.className = "text-right p-3 mb-2";
            userMessageElem.innerHTML = `<span class="bg-blue-600 text-white rounded-lg rounded-br-none py-2 px-4 inline-block">${message}</span>`;
            chatContainer.appendChild(userMessageElem);
            
            // Clear input ONLY if the message was not from the voice input
            if (!messageText) {
                chatInput.value = '';
            }
            mainTextarea.style.height = 'auto'; // Reset textarea height
            suggestionButtonsContainer.style.display = 'none'; // Hide suggestions after first message

            // Display typing indicator
            const typingElem = document.createElement('div');
            typingElem.className = "text-left p-3 mb-2";
            typingElem.innerHTML = `<span class="bg-slate-200 text-slate-600 rounded-lg rounded-bl-none py-2 px-4 inline-block">Typing...</span>`;
            chatContainer.appendChild(typingElem);
            chatContainer.scrollTop = chatContainer.scrollHeight; // Scroll to bottom

            try {
                const response = await fetch(BOT_API_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ message: message }),
                });

                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                const data = await response.json();
                const botResponse = data.response;
                
                // Remove typing indicator and display bot response
                typingElem.remove();
                const botMessageElem = document.createElement('div');
                botMessageElem.className = "text-left p-3 mb-2";
                botMessageElem.innerHTML = `<span class="bg-slate-200 text-slate-800 rounded-lg rounded-bl-none py-2 px-4 inline-block">${botResponse}</span>`;
                chatContainer.appendChild(botMessageElem);

            } catch (error) {
                console.error("Error sending message to bot:", error);
                 // Remove typing indicator and show error
                typingElem.remove();
                const errorElem = document.createElement('div');
                errorElem.className = "text-left p-3 mb-2";
                errorElem.innerHTML = `<span class="bg-red-200 text-red-800 rounded-lg rounded-bl-none py-2 px-4 inline-block">Sorry, I couldn't connect to the bot. Make sure your Colab server is running and the ngrok URL is correct.</span>`;
                chatContainer.appendChild(errorElem);
            } finally {
                 chatContainer.scrollTop = chatContainer.scrollHeight; // Scroll to bottom
                 chatInput.value = ''; // Clear input after bot responds
            }
        }

        sendBtn.addEventListener('click', () => sendMessageToBot());
        
        chatInput.addEventListener('keydown', (e) => {
            // Send message on Enter key, but allow new line with Shift+Enter
            if (e.key === 'Enter' && !e.shiftKey) {
                e.preventDefault();
                sendMessageToBot();
            }
        });
        
        // Add event listeners for suggestion buttons
        suggestionButtonsContainer.addEventListener('click', (e) => {
            if (e.target.tagName === 'BUTTON') {
                const suggestionText = e.target.textContent;
                sendMessageToBot(suggestionText);
            }
        });

        // --- NEW: Logic for FIX 2 (Voice Input) ---
        const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
        if (SpeechRecognition) {
            const recognition = new SpeechRecognition();
            recognition.continuous = false; // Stop recording after silence
            recognition.lang = 'en-IN'; // Set to English (India)
            recognition.interimResults = false;
            recognition.maxAlternatives = 1;

            micBtn.addEventListener('click', () => {
                recognition.start();
                micBtn.classList.add('listening');
            });

            recognition.onresult = (event) => {
                const transcript = event.results[0][0].transcript;
                chatInput.value = transcript; // Put text in box
                sendMessageToBot(transcript); // Automatically send the message
            };

            recognition.onspeechend = () => {
                recognition.stop();
            };

            recognition.onend = () => {
                micBtn.classList.remove('listening');
            };

            recognition.onerror = (event) => {
                console.error("Speech recognition error:", event.error);
                micBtn.classList.remove('listening');
            };

        } else {
            console.log("Speech Recognition not supported in this browser.");
            micBtn.style.display = 'none'; // Hide mic button if not supported
        }

    </script>
</body>
</html>



